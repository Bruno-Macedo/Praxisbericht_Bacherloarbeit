\section{Evaluation der Implementation mit echten Logdateien}
In diesem Abschnitt präsentieren wir unsere Implementierung für die Analyse von \gls{ssh}-Logdateien der Hochschule. Hier hat unsere Logdateien ungefähr vier Megabyte 

\subsection{Einstellungen von Promtail und Loki}
Die Extrahierung des Inhalts der Logdateien erfolgt im Promtail mit folgenden Konfigurationen aus der offiziellen Dokumentation \citep{Grafana_ConfigPromtail}:
\begin{table}[H]
    \setstretch{1}
    \begin{tabularx}{\textwidth}{|m{5.5cm}|X|}
    \hline
    \multicolumn{1}{|c|}{\textbf{Konfigurationsfeld}} & \multicolumn{1}{|c|}{\textbf{Beschreibung}} \\
    \hline
    \textbf{scrape\_configs} & Steht für die Funktionalität von Promtail, automatisch nach Logdateien zu suchen. \\
    \hline
    - job\_name: sshlogs & Definition des Names unseres \quotes{job} \\
    \hline
   
    \textbf{decompression} \newline
    \hphantom{te}enabled: true \newline
    \hphantom{te}initial\_sleep: 10s \newline
    \hphantom{te}format: gz & Promtail kann verschiedene Komprimierungsformate verarbeiten, darunter auch .gz, welches wir in unserer Arbeit verwenden. Das Feld \textit{initial\_sleep} beschreibt das Intervall, bevor die Dekomprimierung beginnt. Dieses Feld kann nützlich sein, wenn komprimierte Dateien vorhanden sind, deren Komprimierungsvorgang jedoch noch nicht abgeschlossen ist. Das Feld \textit{format} gibt das Komprimierungsformat an \citep{Grafana_Promtail}. \\  \hline

    \textbf{static\_configs:} \newline
    - targets: \newline
    \hphantom{te}- loki \newline
    \hphantom{te}labels: \newline
    \hphantom{text}job: sshlogs \newline
    \hphantom{text}instance: \gls{Endpoint}-Name \newline
    \hphantom{text}\_\_path\_\_: /var/log/**.gz & Das Feld \textit{targets} bezieht sich auf die Kommunikation mit der Loki-Instanz. Das Feld \textit{labels} zeigt an, unter welcher Bezeichnung der Inhalt dieser Datei in Loki aufgerufen werden kann. \textit{\_\_path\_\_} gibt den Pfad zur Datei im System an.\\ \hline

    \end{tabularx}
\end{table}

\begin{table}[H]
  \setstretch{1}
  \begin{tabularx}{\textwidth}{|m{5.5cm}|X|}
  \hline
  \multicolumn{1}{|c|}{\textbf{Konfigurationsfeld}} & \multicolumn{1}{|c|}{\textbf{Beschreibung}} \\
  \hline
  
  \textbf{pipeline\_stages:} & Hier können wir den Inhalt der Logzeile definieren, bevor wir es zu Loki schicken. \\

  \hphantom{te}- match: \newline
  \hphantom{tex}selector: '\{job=``sshlogs''\}' \newline
  \hphantom{tex}action: keep \newline & Nur Logzeilen mit diesem \quotes{label} werden modifiziert und dessen Inhalt wird beibehalten. Alternativ gibt es \quotes{drop}, um diesen Inhalt zu löschen. \\   \hline

  \hphantom{tex}\textbf{stages:}  \newline
  \hphantom{tex}- regex: (\glsfirst{RegExp} am Ende dieser Tabelle)\newline
  \hphantom{tex}- timestamp: \newline
  \hphantom{texten}source: time \newline
  \hphantom{texten}format: ``Jan \_2 15:04:05'' \newline
  \hphantom{texten}location: \quotes{Europe/Berlin} & Promtail bietet verschiedene Typen von \quotes{stages} zur Bearbeitung von Logzeilen an. Diese \quotes{stages} werden nacheinander verarbeitet. In unserem Fall verwenden wir die \quotes{stages} \gls{RegExp}, \quotes{labels} und \quotes{Timestamp}.

  Die erste \quotes{stage}, \gls{RegExp}, liest den Zeitstempel und die IP-Adresse aus der Logzeile. Sie ermöglicht es uns, bestimmte Muster in den Logzeilen zu erkennen und die relevanten Informationen zu extrahieren.
  
  Die zweite \quotes{stage}, \quotes{labels}, nutzt die zuvor gefundene IP-Adresse aus der ersten \quotes{stages} und erstellt ein neues Label. Dadurch können wir die Logzeilen basierend auf der IP-Adresse weiter kategorisieren und filtern.
  
  Die letzte \quotes{stage}, \quotes{Timestamp}, nimmt den Zeitstempel aus der Logzeile und speichert ihn in Loki. Dies sorgt dafür, dass das korrekte Datum der Logzeile in Grafana Loki angezeigt wird, anstatt das Datum des Hochladens in Grafana Loki.
  
  Durch die Verwendung dieser \quotes{stages} ermöglicht uns Promtail eine flexible und effiziente Bearbeitung der Logzeilen, um sie besser zu analysieren und visualisieren zu können \\
  \hline

  \end{tabularx}
  \caption[Konfigurationsausschnitt von Promtail]
  {Konfigurationsausschnitt von Promtail}
  \label{tab:KonfigPromtail}
\end{table}

{\setstretch{1.0}
\begin{Verbatim}[frame=single]
'^(?P<time>[A-Za-z]{3}\s{1,2}\d{1,2}\s\d{2}:\d{2}:\d{2}).*from.(?P<source
IP>(?:25[0-5]|(?:2[0-4]|1\d|[1-9]|)\d)\.(?:25[0-5]|(?:2[0-4]|1\d|[1-9]|)\
d)\.(?:25[0-5]|(?:2[0-4]|1\d|[1-9]|)\d)\.(?:25[0-5]|(?:2[0-4]|1\d|[1-9]|)
\d))'
\end{Verbatim}
\label{lst:ReGex_ExtractLabel}
%\caption[\gls{RegExp} für Extrahierung von Datum und IP-Adresse von Logzeile]
}

Unsere gesamte Einstellung für Promtail befindet sich im Anhang \ref{appendix:AngepasstGrafana} auf der Seite \pageref{appendix:AngepasstGrafana}.

In der nächsten Tabelle, \ref{tab:KonfigLoki}, zeigen wir einen Konfigurationsausschnitt von Loki, die wir anpassen mussten, damit unsere Logdateien verarbeitet werden könnten. Diese Konfiguration wurde mithilfe der offizielen Dokumentation \citep{Grafana_ConfigLoki} und des offizielen Forumsbeitrags von Grafana Loki \citep{githubforum} gestaltet.

\begin{table}[H]
  \setstretch{1}
  \begin{tabularx}{\textwidth}{|m{6cm}|X|}
  \hline
  \multicolumn{1}{|c|}{\textbf{Konfigurationsfeld}} & \multicolumn{1}{|c|}{\textbf{Beschreibung}} \\
  \hline
  \textbf{query\_range:} & Bezieht sich auf Abfrage und Ergebnis von Inhalt des Logdateien in spezifischen Zeitspanne. \\
  \hphantom{te}parallelise\_shardable\_queries: true & Der Abfrage-Prozess findet parallel statt.\\ \hline

  \textbf{frontend:} & Dieser Block bezieht sich auf Abfrage in \gls{frontend}-Ebene. \\
  \hphantom{te}max\_outstanding\_per\_tenant: 10000 & Anzahl von erlaubten  ausstehenden Abfrage. Um Leistung zu gewinnen, sagten wir, dass ein einzelner Nutzer, diese Anzahl von ausstehenden Anfrage hat. In einer produktiven Umgebung ist dieser Wert von der Rechenkapazität abhängig.\\ \hline

  \textbf{querier:} & Festelegung der Verarbeitung von Abfrage \\ 
  \hphantom{te}max\_concurrent: 2048 & Anzahl der gleichzeitigen Abfragen, die verarbeitet werden. \\ \hline

  \textbf{limits\_config:} & Festlegung der Aufnahmerate und Nutzung von Ressourcen. \\ 
  \hphantom{te}reject\_old\_samples: false & Ermöglicht die Aufnahme von alten Logdateien, was in unserem Fall notwendig ist, da unsere Datei von April 2022 ist. \\ 
  \hphantom{te}split\_queries\_by\_interval: 15m & Trennung von Abfragen nach einem definierten Intervall. Jeder Intervall wird gleichzeitig ausgeführt \\ 
  \hphantom{te}max\_query\_parallelism: 32 & Maximale Anzahl von parallelen Abfragen.  \\ \hline

  \end{tabularx}
  \caption[Konfigurationsausschnitt von Loki]
  {Konfigurationsausschnitt von Loki}
  \label{tab:KonfigLoki}
\end{table}

\subsection{Generierung von Graphiken}
Nachdem die Konfiguration fertig ist, können wir die \glsplural{container} starten und mithilfe des Musters von \cite{VoidQuark_sshlogs} Grafiken mit Informationen über \gls{ssh}-Verbindungen generieren. Mit der \gls{frontend}-Anwendung Grafana können wir Daten in verschiedenen Zeitspannen anzeigen und nach \quotes{labels} filtern. Als Beispiel zeigen wir in Abbildung \ref{fig:Zeistspanne_22.4} eine Grafik mit fehlgeschlagenen Anmeldeversuchen pro Nutzer am 22.4.2023:

\newpage
\newgeometry{right=30mm, left=30mm}
\thispagestyle{lscape}
\begin{landscape}
    \begin{figure}[H]
       % \centering
        \centerline{\includegraphics[width=1.7\textwidth]{assets/Failed_pro_user.png}}
        \caption[Grapische Darstellung von Anzahl fehlgeschlagenen Anmeldeversuche pro Nutzer vom 22.4.2023]
        {Grapische Darstellung von Anzahl fehlgeschlagenen Anmeldeversuche pro Nutzer vom 22.4.2023}
        \label{fig:Zeistspanne_22.4}
        \centering
    \end{figure}
Aus der Abbildung \ref{fig:Zeistspanne_22.4} können wir ableiten, dass am 22.4.2022 möglicherweise ein \gls{bruteforce} stattgefunden hat. Dabei wurden gängige Benutzernamen verwendet, um Anmeldeversuche durchzuführen. Zum Beispiel gab es 10.330 Versuche mit dem Benutzernamen \quotes{root}, 307 Versuche mit \quotes{user} und 142 Versuche mit \quotes{admin}.
\end{landscape}
\restoregeometry

\newpage
\newgeometry{right=30mm, left=30mm}
\thispagestyle{lscape}
\begin{landscape}
  Wir können weitere Filter anwenden, um beispielsweise zu zeigen, zu welchen Uhrzeiten die meisten Versuche stattgefunden haben, wie auf der Graphik \ref{fig:Zeistfenster_22.4}:
    \begin{figure}[H]
       % \centering
        \centerline{\includegraphics[width=1.6\textwidth]{assets/activityperhour.png}}
        \caption[Darstellung der fehlgeschlagenen Anmeldeversuche in einem Zeitfenster von 24 Stunden am 22.4.2023]
        {Darstellung der fehlgeschlagenen Anmeldeversuche in einem Zeitfenster von 24 Stunden am 22.4.2023}
        \label{fig:Zeistfenster_22.4}
        \centering
    \end{figure}
  Die Abbildung \ref{fig:Zeistfenster_22.4} zeigt, dass die meisten Versuche zwischen 16:00 und 17:30 Uhr stattgefunden haben.
\end{landscape}
\restoregeometry

Grafana bietet zahlreiche Möglichkeiten, um Daten zu kombinieren und darzustellen. Die Nutzungsmöglichkeiten sind praktisch unbegrenzt und hängen von der Kreativität des Benutzers sowie den Anforderungen der jeweiligen Situation ab.

\subsection{Generierung von Warnmeldungen}

% unsere Warnmeldung
% unsere Grafik

% fucking alerts

%https://computingforgeeks.com/run-elastic-stack-elk-on-docker/